"use strict";
require.config(requireConfig),require(["jquery","tmpl","i18n","bootstrap","common"],function(e,i,s,a,n){function r(i){i&&i.usrico?(n.util.setUserImage(e("#current_image"),i.usrico),n.util.setUserImage(e(".big-image img"),i.usrico),n.util.setUserImage(e(".small-image img"),i.usrico)):"0"==i.sex?(n.util.setUserImage(e("#current_image"),"user-female.png"),n.util.setUserImage(e(".big-image img"),"user-female.png"),n.util.setUserImage(e(".small-image img"),"user-female.png")):"1"==i.sex&&(n.util.setUserImage(e("#current_image"),"user-male.png"),n.util.setUserImage(e(".big-image img"),"user-male.png"),n.util.setUserImage(e(".small-image img"),"user-male.png"))}function t(e){e.size>p?g(e,m):o(e,m)}function u(i){var s=window.URL||window.webkitURL,a=s.createObjectURL(i);e("#current_image").attr("src",a)}function o(e,i){var s=new FileReader;s.onload=function(){var a=s.result;i(a,e.name)},s.readAsDataURL(e)}function g(i,s){if("undefined"==typeof FileReader)console.log("The current browser kernel does not support base64 image compression"),o(i,s);else try{var a=new FileReader;a.onload=function(a){var n=e("<img/>");n.load(function(){var e=this.height/(this.width/150),a=document.createElement("canvas"),n=a.getContext("2d"),r=0,t=0,u=0,o=0,g="";a.width=150,a.height=e,n.clearRect(0,0,150,e),this.width>150?(r=Math.round(150),t=e,u=Math.round((r-150)/2)):(t=Math.round(e),r=150,o=Math.round((t-e)/2)),n.drawImage(this,u,o,r,t);var g=a.toDataURL("image/jpeg");s(g,i.name)}),n.attr("src",a.target.result)},a.readAsDataURL(i)}catch(e){console.log("Compression failed!"),o(i,s)}}function m(i,s){var a=c(i,s),t=new FormData;t.append("file",a),t.append("userId",n.util.getUserId()),n.dao.upUserIcon(t,function(i){if(null!==i){var s=sessionStorage.userInfo;s&&(s=JSON.parse(s),s.usrico=i),sessionStorage.userInfo=JSON.stringify(s),r(s),e("#save_success_mask").removeClass("hide")}},null,function(){e("#upload_input").val("")})}function l(){n.dao.upUserIconName({userId:n.util.getUserId(),defaultname:v},function(i){if(null!==i){var s=sessionStorage.userInfo;s&&(s=JSON.parse(s),s.usrico=v),sessionStorage.userInfo=JSON.stringify(s),r(s),e("#save_success_mask").removeClass("hide"),n.util.setUserImage(e("#login_btn img"),s.usrico),n.util.setUserImage(e("#mb_login_btn img"),s.usrico)}},null)}function c(e,i){for(var s=e.split(","),a=s[0].match(/:(.*?);/)[1],n=atob(s[1]),r=n.length,t=new Uint8Array(r);r--;)t[r]=n.charCodeAt(r);return new File([t],i,{type:a})}n.initLoginStatus(function(e){if(e){if(e&&sessionStorage.userInfo){var i=JSON.parse(sessionStorage.userInfo);r(i)}}else window.location.href="../../../login.html"});var d=4194304,p=102400,f=null,v=null;!function(){var i=["user-image-1.png","user-image-2.png","user-image-3.png","user-image-4.png","user-image-5.png","user-image-6.png","user-image-7.png","user-image-8.png","user-image-9.png","user-image-10.png","user-image-11.png","user-image-12.png","user-image-13.png","user-image-14.png","user-image-15.png","user-image-16.png","user-image-17.png","user-image-18.png","user-image-19.png","user-image-20.png"];e("#recommend_image_list").html(e("#userImageTempl").tmpl(i)),e("#recommend_image_list .image-item").bind("click",function(){e("#recommend_image_list .image-item").removeClass("selected"),e(this).addClass("selected"),v=e(this).find("img").data().data,e("#current_image").attr("src","resources/img/user/"+v),e("#upload_input").val(""),f=null})}(),function(){e("#upload_input").change(function(){var i=document.getElementById("upload_input");if(i.files){var s=i.files[0];s.size>d?(alert(e.i18n.map.CommentMaxFileSize),e("#upload_input").val("")):(f=s,u(s))}}),e("#saveBtn").click(function(){null!=f?t(f):null!==v&&l()}),e("#confirmBtn").click(function(){e("#save_success_mask").addClass("hide")})}(),function(){e(".loading-mask").addClass("hide"),e(".main-wrap").removeClass("invisibility"),e("footer").removeClass("invisibility")}()});