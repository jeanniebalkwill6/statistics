"use strict";
require.config(requireConfig),require(["jquery","tmpl","i18n","bootstrap","common"],function(e,t,s,a,r){function d(t){t&&t.usrico?r.util.setUserImage(e("#sex_image"),t.usrico):"0"==t.sex?e("#sex_image").attr("src","resources/img/user/user-female.png"):"1"==t.sex&&e("#sex_image").attr("src","resources/img/user/user-female.png")}function i(t){e(".loading-my-message").removeClass("hide"),e(".empty-data").addClass("hide"),e("#my_message_list").addClass("hide"),e("#my_qst_wrap").addClass("hide"),e(".send-msg-wrap").addClass("hide"),r.dao.getMsgList({userId:r.util.getUserId(),infoType:t},function(s){if(1==t){var a=s.disInfo;if(e(".loading-my-message").addClass("hide"),a&&a.length>0){for(var d=0;d<a.length;d++){var i=a[d];i.crtime=r.util.formatOrderDateTime(i.crtime)}e("#my_message_list").html(e("#MyDisMessageTempl").tmpl(a)),e(".empty-data").addClass("hide"),e("#my_message_list").removeClass("hide")}else n()}else{var a=s.csInfo;if(e(".loading-my-message").addClass("hide"),a.chatlist&&a.chatlist.length>0){for(var m=a.chatlist,d=0;d<m.length;d++){var i=m[d];i.crtime=r.util.formatOrderDateTime(i.crtime),"2"==i.msgType&&(i.msgCnt=r.util.msgUrl+i.msgCnt)}e("#my_message_list").html(e("#MyChatMessageTempl").tmpl(m)),e("#my_message_list .chat-message-item #system_name").html(e.i18n.map.MessageCustomer),e("#my_message_list .chat-message-item #user_name").html(g),e("#my_message_list .chat-message-item .user-image #user_image").attr("onerror",e("#sex_image")[0].onerror),e("#my_message_list .chat-message-item .user-image #user_image").attr("src",e("#sex_image")[0].src),e(".empty-data").addClass("hide"),e("#my_message_list").removeClass("hide"),e("#my_message_list #cfaddr").each(function(){e(this).click(function(){p=e(this).data().data,u(p)})})}a.qstList&&a.qstList.length>0?(e("#my_qst_list").html(e("#MyQstMessageTempl").tmpl(a.qstList)),e("#my_qst_list .qst-item").each(function(){e(this).click(function(){o(e(this).data().data)})}),e("#my_qst_wrap").removeClass("hide")):e("#my_qst_wrap").addClass("hide"),e(".send-msg-wrap").removeClass("hide"),document.getElementById("send_msg_input").scrollIntoView()}},function(){1==t?n():(e(".loading-my-message").addClass("hide"),e(".send-msg-wrap").removeClass("hide"),document.getElementById("send_msg_input").scrollIntoView())},function(){l()})}function n(){e(".loading-my-message").addClass("hide"),e(".empty-data").removeClass("hide"),e("#my_message_list").addClass("hide")}function o(e){var t=r.util.getUserId();t?r.dao.sendMsg({userId:t,type:"1",msgType:"1",msgCnt:e},function(){i(2)}):window.location.href="../../../login.html"}function m(t,s,a){var d=r.util.getUserId();d?r.dao.sendMsg({userId:d,type:"2",msgType:s||"1",msgCnt:t,extp1:a},function(){i(2),s||e("#send_msg_input").val("")}):window.location.href="../../../login.html"}function l(){r.dao.getMsgSummary({userId:r.util.getUserId(),infoType:"0"},function(t){t&&t.disInfo&&0!=t.disInfo.unRead?(e("#message_1_number").html("("+t.disInfo.unRead+")"),e("#message_1_number").removeClass("hide")):e("#message_1_number").addClass("hide"),t&&t.csInfo&&0!=t.csInfo.unRead?(e("#message_2_number").html("("+t.csInfo.unRead+")"),e("#message_2_number").removeClass("hide")):e("#message_2_number").addClass("hide"),e("#message_number").html(t.unRead)})}function u(t){r.dao.getOrderDetail({orderId:t},function(t){if("0"==t.cfaddrStatus){e("#confirm_address_mask").removeClass("hide");var s=t.shippingAddr;if(s){var a=s.recFirstname+s.recLastname,r=s.telephone,d=s.streetAddr+" "+s.extendAddr+" "+s.city+", "+s.province+" "+s.postCode+", "+s.fullCountry;e("#order_detail_name").html(a),e("#order_mobile_name").html(r),e("#order_address_name").html(d)}else i(2)}else i(2)})}function c(){r.dao.upcfAddrStatus({orderId:p,status:"1"},function(t){p=null,i(2),e("#confirm_address_mask").addClass("hide")})}function _(t){console.log("updateImage");var s=new FormData;s.append("imgfile",t),s.append("userId",r.util.getUserId()),r.dao.sendImgMsg(s,function(t){i(e(".my-message-tab-wrap .tab.selected").data().data+1)},null,function(){e("#upload_input").val("")})}var g=null,p=null;r.initLoginStatus(function(t){if(t){if(sessionStorage.userInfo){var s=JSON.parse(sessionStorage.userInfo);s.firstName?g=s.firstName+s.lastName:s.email&&(g=s.email),e("#name").text(g),d(s)}sessionStorage.commentSwitch&&"1"==sessionStorage.commentSwitch?e("#menu_my_comment").removeClass("hide"):e("#menu_my_comment").addClass("hide"),sessionStorage.messageSwitch&&"1"==sessionStorage.messageSwitch?e("#menu_my_message").removeClass("hide"):e("#menu_my_message").addClass("hide")}else window.location.href="../../../login.html"});var h=r.util.getQueryString("index");h||(h=1);var f=r.util.getQueryString("productId"),y=r.util.getQueryString("productColorId"),C=r.util.getQueryString("orderId"),v=null;!function(){e(".my-message-tab-wrap .tab").each(function(){e(this).click(function(){e(".my-message-tab-wrap .tab").removeClass("selected"),e(this).addClass("selected");var t=e(this).data().data;0==t?(e(".send-msg-wrap").addClass("hide"),e("#my_qst_wrap").addClass("hide"),e("#product_detail_wrap").addClass("hide"),e("#order_detail_wrap").addClass("hide")):1==t&&(e(".send-msg-wrap").removeClass("hide"),e("#my_qst_wrap").removeClass("hide"),f&&e("#product_detail_wrap").removeClass("hide"),C&&e("#order_detail_wrap").removeClass("hide"),document.getElementById("send_msg_input").scrollIntoView()),i(t+1)})}),e("#send_msg_btn").click(function(){var t=e("#send_msg_input").val();t&&t.length>0?m(t):alert("message null")}),e("#refresh_btn").click(function(){i(e(".my-message-tab-wrap .tab.selected").data().data+1)}),e("#product_send_btn").click(function(){m(e("#product_send_btn").parent().parent().find("#product_detail").prop("outerHTML"),"3")}),e("#confirm_btn").click(function(){c()}),e("#customservice_btn").click(function(){e("#confirm_address_mask").addClass("hide")}),e("#confirm_address_close_btn").click(function(){e("#confirm_address_mask").addClass("hide")}),e("#upload_input").change(function(){var e=document.getElementById("upload_input");e.files&&_(e.files[0])})}(),function(){1==h?(e(".my-message-tab-wrap .tab:first-child").addClass("selected"),e(".my-message-tab-wrap .tab:last-child").removeClass("selected")):(e(".my-message-tab-wrap .tab:first-child").removeClass("selected"),e(".my-message-tab-wrap .tab:last-child").addClass("selected")),1==h?(e(".send-msg-wrap").addClass("hide"),e("#my_qst_wrap").addClass("hide")):2==h&&(e(".send-msg-wrap").removeClass("hide"),e("#my_qst_wrap").removeClass("hide"))}(),l(),i(h),f&&function(){r.dao.productDetail({productId:f,currencyId:r.util.getLocalCurrency(),userId:r.util.getUserId()},function(t){if(t&&t.color_data&&t.color_data.length>0)for(var s=0;s<t.color_data.length;s++){var a=t.color_data[s];if(a.color_id==y){e("#product_detail_wrap #product_image").attr("src",r.util.picUrl+a.img_groups[0].small_img),e("#product_detail_wrap #product_name").html(a.pcName);var d=r.util.getCurrencySymbol(r.util.getLocalCurrency());e("#product_detail_wrap #product_price").html(r.util.formatProductPrice(a.current_price,d));var i=r.util.getAdvSource().u;i||(i=r.util.getQueryString("u"));var n="";i&&(n="?u="+i);var o=r.util.encodeMenuType(r.util.getUvid()),m=window.location.protocol+"//"+window.location.host+"/"+r.util.formatProductName(a.pcName)+"-d-"+r.util.encodeMenuType(f)+"-"+r.util.encodeMenuType(y)+"-"+o+".html"+n;e("#product_detail_wrap #product_detail").attr("href",m),e("#product_detail_wrap").removeClass("hide"),document.getElementById("send_msg_input").scrollIntoView();break}}})}(),C&&function(){r.dao.getOrderDetail({orderId:C},function(t){var s=r.util.getCurrencySymbol(t.correncyCode);s||(s=r.util.getCurrencySymbol(r.util.getLocalCurrency())),0==t.paymentStatus?t.paymentStatusString=e.i18n.map.OrderStatusPendding:1==t.paymentStatus||10==t.paymentStatus?t.paymentStatusString=e.i18n.map.OrderStatusSuccess:2==t.paymentStatus?t.paymentStatusString=e.i18n.map.OrderStatusFail:3==t.paymentStatus?t.paymentStatusString=e.i18n.map.OrderStatusDelay:4==t.paymentStatus&&(t.paymentStatusString=e.i18n.map.OrderStatusDelivered);for(var a=r.util.encodeMenuType(r.util.getUvid()),d=t.spCart,i=0;i<d.length;i++){var n=d[i];n.displayImg=r.util.picUrl+n.displayImg;var o=window.location.protocol+"//"+window.location.host+"/"+r.util.formatProductName(n.productName)+"-d-"+r.util.encodeMenuType(n.productId)+"-"+r.util.encodeMenuType(n.productColorId)+"-"+a+".html";n.href=o}e("#order_list").html(e("#orderItemTempl").tmpl(d)),e("#order_list .order-send-btn").html(e.i18n.map.SendProductLink),e("#order_list .order-send-btn").each(function(){e(this).click(function(){var t=e(this).data().data,a=v.spCart[t];e("#order_link_content #order_no_2").html(v.orderId),e("#order_link_content #order_date_2").html(r.util.formatOrderDateTime(v.crTime)),e("#order_link_content #order_product_info").attr("href",a.href),e("#order_link_content #order_product_image").attr("src",a.displayImg),e("#order_link_content #order_product_name").html(a.productName),e("#order_link_content #order_price").html(r.util.formatProductPrice(v.realCost,s)),e("#order_link_content #order_status").html(v.paymentStatusString),m(e("#order_link_content").find("#message_content").prop("outerHTML"),"3","1")})}),e("#order_no").html(t.orderId),e("#order_date").html(r.util.formatOrderDateTime(t.crTime)),v=t,e("#order_detail_wrap").removeClass("hide")})}()});