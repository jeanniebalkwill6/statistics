"use strict";
require.config(requireConfig),require(["jquery","tmpl","i18n","bootstrap","common","bootstrapPaginator"],function(e,t,i,r,a,o){function n(){e("#load_more_btn").unbind("click").click(function(){m.curPage<h&&!_&&(_=!0,m.curPage=m.curPage+1,e("#list_refresh_loading").removeClass("hide"),l(f))}),a.util.isMobile()&&e(window).bind("scroll",function(){console.log(),e(document).scrollTop()+e(window).height()>e(document).height()-10&&!_&&m.curPage<h&&(_=!0,m.curPage=m.curPage+1,e("#list_refresh_loading").removeClass("hide"),l(f))})}function l(t){a.dao.searchProducts({keyWord:t,currentPage:m.curPage,orderby:g,currencyId:a.util.getLocalCurrency()},function(t){if(t.page){m.amount=t.page.amount,m.pageSize=t.page.pageSize;var i=(m.curPage-1)*m.pageSize+1,r=m.curPage*m.pageSize;r>m.amount&&(r=m.amount),a.util.isMobile()?e("#current_product_number").html("1-"+r):e("#current_product_number").html(i+"-"+r),e("#product_total_number").html(m.amount),h=m.amount%m.pageSize==0?parseInt(m.amount/m.pageSize):parseInt(m.amount/m.pageSize)+1}else e("#current_product_number").html("0-0"),e("#product_total_number").html(0);var o=t.products;o&&o.length>0?(s(o),p(o),c(),e("#item_list").show(),e(".empty-data").hide()):(e("#item_list").hide(),e(".empty-data").show()),e(".sort-wrap").removeClass("invisibility"),_=!1})}function s(t){var i=a.util.getCurrencySymbol(a.util.getLocalCurrency()),r=a.util.getAdvSource().u;r||(r=a.util.getQueryString("u"));var o=a.util.encodeMenuType(a.util.getUvid()),l="";r&&(l="?u="+r);for(var s=0;s<t.length;s++){for(var c=t[s],u=0;u<c.display_data.length;u++){var d=c.display_data[u];d.original_price=a.util.formatProductPrice(d.original_price,i),d.current_price=a.util.formatProductPrice(d.current_price,i),d.img_display=a.util.picUrl+d.img_display,d.color_img=a.util.picUrl+d.color_img,d.height=a.util.getImageHeight(),d.top=Number(a.util.getImageHeight())-50,d.href=a.util.formatProductName(c.product_name)+"-d-"+a.util.encodeMenuType(c.product_id)+"-"+a.util.encodeMenuType(d.color_id)+"-"+o+".html"+l}c.showColor=sessionStorage.img_block}if(a.util.isMobile()){1==m.curPage&&e("#item_list").html("");var p=e("#item_list").html();e("#item_list").html(e("#productItemTempl").tmpl(t)),p+=e("#item_list").html(),e("#item_list").html(p)}else e("#item_list").html(e("#productItemTempl").tmpl(t));e("#item_list #new_label").text(e.i18n.map.listNewLabel),n()}function c(){a.util.isMobile()?(e("#top_page").addClass("hide"),u(h)):(e("#top_page").removeClass("hide"),d(h))}function u(t){t>1&&m.curPage<t?(e("#load_more_btn").removeClass("hide"),e("#list_refresh_loading").removeClass("hide")):(e("#load_more_btn").addClass("hide"),e("#list_refresh_loading").addClass("hide"))}function d(t){e("#load_more_btn").addClass("hide"),e("#list_loading").addClass("hide"),e(function(){var i={bootstrapMajorVersion:1,currentPage:m.curPage,totalPages:t,shouldShowPage:!0,onPageClicked:function(t,r,a,o){m.curPage!==o&&(m.curPage=o,e("html").scrollTop(0),l(f),i.currentPage=o,"top_page"==t.currentTarget.id?e("#page").bootstrapPaginator(i):e("#top_page").bootstrapPaginator(i))},onPageChanged:function(e,t,i){var r=window.location.href;r.indexOf("/#/")>-1&&(r=r.substring(0,r.indexOf("/#/"))),history.pushState("","",r+"/#/"+i)}};e("#page").bootstrapPaginator(i),e("#top_page").bootstrapPaginator(i)})}function p(t){e("#item_list .color-wrap img").bind("click",function(i){i.stopPropagation();var r=e(this).parent().parent().parent().data().data,a=e(this).data().data,o=t[r].display_data[a];e(this).parent().parent().find("img").removeClass("selected"),e(this).addClass("selected");var n=o.href;e(this).parent().parent().parent().find("a:first").attr("href",n),e(this).parent().parent().parent().find("img:first").attr("src",o.img_display),e(this).parent().parent().parent().find(".price-wrap .goods-price").html(o.current_price),e(this).parent().parent().parent().find(".price-wrap .goods-del-price").html(o.original_price)})}console.log("list.js"),a.initLoginStatus();var g=1,m={amount:0,curPage:1,pageSize:0},_=!1,h=0;setTimeout(function(){e("#sort_method").html(e("#sort_list li a:first")[0].text),e("#sort_list li a").bind("click",function(){e("#sort_method").html(e(this)[0].text),m.curPage=1,g=Number(e(this)[0].id),l(f)})},50);var f=a.util.getQueryString("keyword");f?(e("#main_search_wrap").addClass("hide"),e("#search_input").val(decodeURIComponent(f)),a.setCurrencyCodeCallback(function(){l(f),sessionStorage.s_fm_bg&&e("#load_more_btn").css("background",sessionStorage.s_fm_bg),sessionStorage.s_fm_fc&&e("#load_more_btn").css("color",sessionStorage.s_fm_fc)})):a.util.isMobile()&&(e("#main_search_wrap").removeClass("hide"),e("#main_search_input").bind("keydown",function(t){"13"==t.keyCode&&(f=e("#main_search_input").val())&&l(f)}),e("#main_search_btn").click(function(){(f=e("#main_search_input").val())&&l(f)}))});